;(function($){var defolts={inputs:[$('<input/>',{type:"text",name:"name",placeholder:"Введите имя",id:"CBname"}),$('<input/>',{type:"tel",name:"phone",placeholder:"Введите телефон",id:"CBphone"}),$('<button/>',{type:"button",id:"CBsend",text:"Отправить"})],submit_type:"ajax",form_attrs:{},error_class:"errorField",ajax_options:{type:"POST",url:"",success:ajaxSuccess,error:ajaxError,},load_animation:$('<div/>',{id:"Loading",html:"<img src='img/load_gif.GIF' alt='Загрузка' />"}),tel_options:{mask:"+7(999)999-99-99",template:/^\+([\()-]?[\d]){11}$/},submit_error:"Заполните поля!",remove_element:"yes"};function BackCall(element,options)
{widget=this;widget.config=$.extend(true,{},defolts,options);widget.element=element;widget.init();}
BackCall.prototype.init=function(){form=this.element.find('form');var inputsLength=this.config.inputs.length;for(i=0;i<inputsLength;i++){this.config.inputs[i].appendTo(form);}
if($("input[type=tel]").length>0)$("input[type=tel]").mask(this.config.tel_options.mask);this.element.fadeIn(500).on('change','input',changeInput).on('submit',submitForm).on('click','button',submitForm).on('click','#closebtn',closeBackCall);}
function changeInput(e){var elem=$(this);var value=e.target.value;var type=e.target.type;var template;switch(type){case"tel":template=widget.config.tel_options.template;break;case"email":template=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,4})+$/;break;default:template=/^[a-zA-Zа-яА-ЯёЁ`]{2,}([/\s-/]?[a-zA-Zа-яА-ЯёЁ`]{2,})*$/;break;}
if(value.search(template)!==-1)
{if(elem.hasClass(widget.config.error_class))elem.removeClass(widget.config.error_class);}
else
{elem.addClass(widget.config.error_class);}}
function submitForm(e){e.preventDefault();var errors=0;widget.element.find('input').each(function(){var elem=$(this);if(elem.hasClass(widget.config.error_class)||elem.val()==''){if(elem.hasClass(widget.config.error_class)!==true){elem.addClass(widget.config.error_class);}errors+=1;}});if(errors>0){alert(widget.config.submit_error);return false;}
if(widget.config.submit_type=="ajax")
{var dataObj={data:form.serialize()};form.trigger('reset').html(widget.config.load_animation);var ajaxSettings=$.extend(true,{},widget.config.ajax_options,dataObj)
setTimeout(function(){$.ajax(ajaxSettings);},1000);}
else
{form.attr({action:widget.config.form_attrs.action,method:widget.config.form_attrs.method}).submit();}}
function closeBackCall(e){e.preventDefault();widget.element.fadeOut(500);if(widget.config.remove_element=="yes")
{setTimeout(function(){widget.element.remove();},500);}}
function ajaxSuccess(data){if(Boolean(data)===true){form.html('<p>Ваше обращение принято!</p>');}
else{form.html('<p>Ошибка! Попробуйте позже или обратитесь по телефону.</p>');}}
function ajaxError(xhr,ajaxOptions,thrownError){console.log(xhr.responseText);console.log(xhr);form.html('<p>Ошибка на сервере! Обратитесь по телефону.</p>');}
$.fn.backCall=function(options)
{new BackCall(this,options);return this;}})(jQuery);