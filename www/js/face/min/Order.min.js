$(document).ready(function(){function e(e){var r=0;return $.each(e,function(){this.length>0&&(this.hasClass("errorField")||""==this.val())&&(this.hasClass("errorField")!==!0&&this.addClass("errorField"),r+=1)}),r}function r(){valid=!0;var r=[$("#name"),$("#lastname"),$("#city"),$("#phone")];return e(r)>0?!1:valid}var t=window.location.href;$("#Order_form #Send").off("click"),$("#Order_form #Send").on("click",function(e){e.preventDefault();var t=parseFloat($("#sum_cart").text());$("#modal_shape").fadeIn(500);var i=r();i!==!1&&t>0?($(this).attr("disabled","disabled"),$.ajax({type:"POST",data:$("#Order_form").serialize(),url:"controllers/face/Add_Order.php",dataType:"json",success:function(e){e===!0?($("form").trigger("reset"),setTimeout(function(){window.location.replace("13-spasibo")},3e3)):alert("Ошибка! Попробуйте еще раз или свяжитесь с нами по телефону.")},error:function(e,r,t){alert("Ошибка на сервере! Свяжитесь с нами по телефону!")}})):alert("Поля заполнены некорректно!"),$("#modal_shape").fadeOut(100),$(this).removeAttr("disabled")}),t.indexOf("type=express")+1?$("#steps").hide():$("#deliv_adress, .labelGroup_2, #Send").hide(),$("#Order_form").off("click","#steps"),$("#Order_form").on("click","#steps",function(e){var r=$(".labelGroup_1"),t=$(".labelGroup_2"),i=t.css("display");"none"==i?(r.hide(),t.show(),$("#Send").show(),$(this).text("Назад")):(t.hide(),$("#Send").hide(),r.show(),$(this).text("Далее...")),e.preventDefault()}),$("input#name, input#lastname, input#phone, input#email").change(function(){var e=$(this),r=e.attr("id"),t=e.val(),i="";switch(r){case"phone":i=/^\+([\()-]?[\d]){11}$/;break;case"email":i=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,4})+$/;break;default:i=/^[a-zA-Zа-яА-ЯёЁ`]{2,}([\/\s-\/]?[a-zA-Zа-яА-ЯёЁ`]{2,})*$/}-1!==t.search(i)?e.hasClass("errorField")&&e.removeClass("errorField"):e.addClass("errorField")}),$("#Order_form").off("blur","#city"),$("#Order_form").on("blur","#city",function(){var e=$(this),r=e.val();""!=r&&r.length>2?(e.hasClass("errorField")&&e.removeClass("errorField"),"симферополь"==r.toLowerCase()?($('#delivery option[value="2"]').length>0&&$('#delivery option[value="2"]').remove(),0==$('#delivery option[value="1"]').length&&$('<option value="1" selected="selected" >Самовывоз</option>').prependTo($("#delivery")),setTimeout(function(){$("select").trigger("refresh")},1)):($('#delivery option[value="1"]').length>0&&$('#delivery option[value="1"]').remove(),0==$('#delivery option[value="2"]').length&&$('<option value="2" selected="selected" >Доставка до склада</option>').prependTo($("#delivery")),setTimeout(function(){$("select").trigger("refresh")},1))):setTimeout(function(){e.addClass("errorField")},100)}),$("#Order_form").off("change","#delivery"),$("#Order_form").on("change","#delivery",function(){var e=$("#delivery :selected").val();2==e?$("#deliv_adress").show():$("#deliv_adress").hide()}),$("input#phone").mask("+7(999)999-99-99")});