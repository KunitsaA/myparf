$(document).ready(function(){function t(t){$('.Object[data-id="'+t+'"], .product[data-id="'+t+'"]').find(".to_cart").attr("disabled","disabled").text("В корзине")}function a(a){if(a.tovars&&a.tovars.length>0){for(var n in a.tovars)t(a.tovars[n].id);var o=$(".Cart_block a").attr("href");"#"==o&&$(".Cart_block a").attr("href","8-cart")}}function n(){$.ajax({url:"controllers/face/addToCart.php",dataType:"json",success:function(t){$("#count_cart").text(t.count),$("#sum_cart").text(accounting.formatNumber(t.sum,0," ")),a(t)}})}function o(t,a){var n=t.parents(".product_item"),o=n.data("id");$.ajax({type:"POST",data:{n_cont:o,vali:a},url:"controllers/face/addToCart.php",dataType:"json",success:function(a){$("#total,#sum_cart").text(accounting.formatNumber(a.sum,0," ")),$("#count_cart").text(a.count),t.parents(".product_item").find(".total").text(accounting.formatNumber(a.nsum,0," "));var n=0;$('input[name="count"]').each(function(){n+=parseFloat($(this).val())}),$("#count").text(n)}})}n(),$(".Cart_block").off("click","a"),$(".Cart_block").on("click","a",function(t){var a=parseFloat($("#count_cart").text());a>0&&window.location.replace("8-cart"),t.preventDefault()});var e=41;$(window).scroll(function(){var t=$(this).scrollTop(),a=$(".head");a.find(".row"),a.find(".cols");e>t?(a.removeClass("scrolling"),0==$(".top #callMMenu").length&&($("#callMMenu").prependTo(".top .cols"),$(window).width()>719&&$("#callMMenu").hide())):(a.hasClass("scrolling")||a.addClass("scrolling"),0==$(".head #callMMenu").length&&($("#callMMenu").appendTo(".head .cols:first"),$(window).width()>719&&$("#callMMenu").show()))}),$(".catalog").off("click",".to_cart"),$(".catalog").on("click",".to_cart",function(){var t=$(this),a=t.parents(".Object"),n=a.find('input[name="id"]').val(),o=parseFloat(a.find(".cena span").text().replace(/ +/g,"")),e=a.find('input[name="count"]').val(),c=$(".Cart_block").offset(),r=a.find(".main_img").offset(),i=Math.round(c.left)+30+"px",l="0px";a.find(".main_img").clone().css({position:"fixed","z-index":"100000",left:r.left+"px",top:r.top-$(window).scrollTop()+"px"}).appendTo("body").animate({opacity:1,left:i,top:l,marginLeft:"0px",marginTop:"0px",width:"50px",height:"50px"},1e3,function(){$(this).remove()}),$.ajax({type:"POST",data:{id:n,cena:o,count:e},url:"controllers/face/addToCart.php",dataType:"json",success:function(a){setTimeout(function(){$("#count_cart").text(a.count),$("#sum_cart").text(accounting.formatNumber(a.sum,0," "))},1e3);var n=$(".Cart_block a").attr("href");"#"==n&&$(".Cart_block a").attr("href","8-cart"),t.attr("disabled","disabled").text("В корзине")}})}),$(".product").off("click",".to_cart"),$(".product").on("click",".to_cart",function(){var t=$(this),a=t.parents(".product"),n=a.find('input[name="id"]').val(),o=parseFloat(a.find(".cena span").text().replace(/ +/g,"")),e=a.find('input[name="count"]').val(),c=$(".Cart_block").offset(),r=a.find(".main_img").offset(),i=Math.round(c.left)-Math.round(r.left)+30+"px",l=Math.round(c.top-r.top)+20+"px";a.find(".main_img").clone().css({position:"absolute","z-index":"100000"}).appendTo(a.find(".main_img").parent()).animate({opacity:1,left:i,top:l,marginLeft:"0px",marginTop:"0px",width:"50px",height:"50px"},1e3,function(){$(this).remove()}),$.ajax({type:"POST",data:{id:n,cena:o,count:e},url:"controllers/face/addToCart.php",dataType:"json",success:function(a){setTimeout(function(){$("#count_cart").text(a.count),$("#sum_cart").text(accounting.formatNumber(a.sum,0," "))},1e3);var n=$(".Cart_block a").attr("href");"#"==n&&$(".Cart_block a").attr("href","8-cart"),t.attr("disabled","disabled").text("В корзине")}})}),$('input[name="count"]').keyup(function(){var t=parseFloat($(this).val());0>=t&&$(this).val(1)}),$('input[name="count"]').off("change keyup"),$('input[name="count"]').on("change keyup",function(){var t=$(this),a=t.val();a>0&&o(t,a)}),$("#product_list").off("click",".delete"),$("#product_list").on("click",".delete",function(t){var a=$(this),n=a.parents(".product_item"),o=n.data("id");$.ajax({type:"POST",data:{del:o},url:"controllers/face/addToCart.php",dataType:"json",success:function(t){$("#total,#sum_cart").text(accounting.formatNumber(t.sum,0," ")),$("#count_cart").text(t.count),n.remove();var a=0;$('input[name="count"]').each(function(){a+=parseFloat($(this).val())}),$("#count").text(a)}}),t.preventDefault()}),$(".body_cart_table").on("click",".detalization",function(t){var a=$("#product_list"),n=a.css("display"),o=$(this);"none"==n?($("#product_list").slideDown(),o.text("Скрыть товары")):($("#product_list").slideUp(),o.text("Показать товары")),t.preventDefault()})});