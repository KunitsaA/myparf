!function(e){e.fn.styler=function(t){var s=e.extend({wrapper:"form",idSuffix:"-styler",filePlaceholder:"Файл не выбран",fileBrowse:"Обзор...",selectPlaceholder:"Выберите...",selectSearch:!1,selectSearchLimit:10,selectSearchNotFound:"Совпадений не найдено",selectSearchPlaceholder:"Поиск...",selectVisibleOptions:0,singleSelectzIndex:"100",selectSmartPositioning:!0,onSelectOpened:function(){},onSelectClosed:function(){},onFormStyled:function(){}},t);return this.each(function(){function t(){var e="",t="",i="",o="";void 0!==l.attr("id")&&""!==l.attr("id")&&(e=' id="'+l.attr("id")+s.idSuffix+'"'),void 0!==l.attr("title")&&""!==l.attr("title")&&(t=' title="'+l.attr("title")+'"'),void 0!==l.attr("class")&&""!==l.attr("class")&&(i=" "+l.attr("class"));for(var c=l.data(),a=0;a<c.length;a++)""!==c[a]&&(o+=" data-"+a+'="'+c[a]+'"');this.id=e+o,this.title=t,this.classes=i}var l=e(this);l.is(":checkbox")?l.each(function(){if(1>l.parent("div.jq-checkbox").length){var s=function(){var s=new t,i=e("<div"+s.id+' class="jq-checkbox'+s.classes+'"'+s.title+'><div class="jq-checkbox__div"></div></div>');l.css({position:"absolute",zIndex:"-1",opacity:0,margin:0,padding:0}).after(i).prependTo(i),i.attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none",display:"inline-block",position:"relative",overflow:"hidden"}),l.is(":checked")&&i.addClass("checked"),l.is(":disabled")&&i.addClass("disabled"),i.on("click.styler",function(){return i.is(".disabled")||(l.is(":checked")?(l.prop("checked",!1),i.removeClass("checked")):(l.prop("checked",!0),i.addClass("checked")),l.change()),!1}),l.closest("label").add('label[for="'+l.attr("id")+'"]').click(function(e){i.click(),e.preventDefault()}),l.on("change.styler",function(){l.is(":checked")?i.addClass("checked"):i.removeClass("checked")}).on("keydown.styler",function(e){32==e.which&&i.click()}).on("focus.styler",function(){i.is(".disabled")||i.addClass("focused")}).on("blur.styler",function(){i.removeClass("focused")})};s(),l.on("refresh",function(){l.off(".styler").parent().before(l).remove(),s()})}}):l.is(":radio")?l.each(function(){if(1>l.parent("div.jq-radio").length){var i=function(){var i=new t,o=e("<div"+i.id+' class="jq-radio'+i.classes+'"'+i.title+'><div class="jq-radio__div"></div></div>');l.css({position:"absolute",zIndex:"-1",opacity:0,margin:0,padding:0}).after(o).prependTo(o),o.attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none",display:"inline-block",position:"relative"}),l.is(":checked")&&o.addClass("checked"),l.is(":disabled")&&o.addClass("disabled"),o.on("click.styler",function(){return o.is(".disabled")||(o.closest(s.wrapper).find('input[name="'+l.attr("name")+'"]').prop("checked",!1).parent().removeClass("checked"),l.prop("checked",!0).parent().addClass("checked"),l.change()),!1}),l.closest("label").add('label[for="'+l.attr("id")+'"]').click(function(e){o.click(),e.preventDefault()}),l.on("change.styler",function(){l.parent().addClass("checked")}).on("focus.styler",function(){o.is(".disabled")||o.addClass("focused")}).on("blur.styler",function(){o.removeClass("focused")})};i(),l.on("refresh",function(){l.off(".styler").parent().before(l).remove(),i()})}}):l.is(":file")?l.css({position:"absolute",top:0,right:0,width:"100%",height:"100%",opacity:0,margin:0,padding:0}).each(function(){if(1>l.parent("div.jq-file").length){var i=function(){var i=new t,o=e("<div"+i.id+' class="jq-file'+i.classes+'"'+i.title+' style="display: inline-block; position: relative; overflow: hidden"></div>'),c=e('<div class="jq-file__name">'+s.filePlaceholder+"</div>").appendTo(o);e('<div class="jq-file__browse">'+s.fileBrowse+"</div>").appendTo(o),l.after(o),o.append(l),l.is(":disabled")&&o.addClass("disabled"),l.on("change.styler",function(){var e=l.val();if(l.is("[multiple]"))for(var e="",t=l[0].files,i=0;i<t.length;i++)e+=(i>0?", ":"")+t[i].name;c.text(e.replace(/.+[\\\/]/,"")),""===e?(c.text(s.filePlaceholder),o.removeClass("changed")):o.addClass("changed")}).on("focus.styler",function(){o.addClass("focused")}).on("blur.styler",function(){o.removeClass("focused")}).on("click.styler",function(){o.removeClass("focused")})};i(),l.on("refresh",function(){l.off(".styler").parent().before(l).remove(),i()})}}):l.is("select")?l.each(function(){if(1>l.parent("div.jqselect").length){var i=function(){function i(t){t.off("mousewheel DOMMouseScroll").on("mousewheel DOMMouseScroll",function(t){var s=null;"mousewheel"==t.type?s=-1*t.originalEvent.wheelDelta:"DOMMouseScroll"==t.type&&(s=40*t.originalEvent.detail),s&&(t.stopPropagation(),t.preventDefault(),e(this).scrollTop(s+e(this).scrollTop()))})}function o(){for(var e=0,t=n.length;t>e;e++){var s="",l="",i=s="",o="",c="";n.eq(e).prop("selected")&&(l="selected sel"),n.eq(e).is(":disabled")&&(l="disabled"),n.eq(e).is(":selected:disabled")&&(l="selected sel disabled"),void 0!==n.eq(e).attr("class")&&(i=" "+n.eq(e).attr("class"),c=' data-jqfs-class="'+n.eq(e).attr("class")+'"');var a,r=n.eq(e).data();for(a in r)""!==r[a]&&(s+=" data-"+a+'="'+r[a]+'"');s="<li"+c+s+' class="'+l+i+'">'+n.eq(e).html()+"</li>",n.eq(e).parent().is("optgroup")&&(void 0!==n.eq(e).parent().attr("class")&&(o=" "+n.eq(e).parent().attr("class")),s="<li"+c+' class="'+l+i+" option"+o+'">'+n.eq(e).html()+"</li>",n.eq(e).is(":first-child")&&(s='<li class="optgroup'+o+'">'+n.eq(e).parent().attr("label")+"</li>"+s)),d+=s}}function c(){var c=new t,a=e("<div"+c.id+' class="jq-selectbox jqselect'+c.classes+'" style="display: inline-block; position: relative; z-index:'+s.singleSelectzIndex+'"><div class="jq-selectbox__select"'+c.title+' style="position: relative"><div class="jq-selectbox__select-text"></div><div class="jq-selectbox__trigger"><div class="jq-selectbox__trigger-arrow"></div></div></div></div>');l.css({margin:0,padding:0}).after(a).prependTo(a);var r=e("div.jq-selectbox__select",a),h=e("div.jq-selectbox__select-text",a),c=n.filter(":selected");o();var f="";s.selectSearch&&(f='<div class="jq-selectbox__search"><input type="search" autocomplete="off" placeholder="'+s.selectSearchPlaceholder+'"></div><div class="jq-selectbox__not-found">'+s.selectSearchNotFound+"</div>");var p=e('<div class="jq-selectbox__dropdown" style="position: absolute">'+f+'<ul style="position: relative; list-style: none; overflow: auto; overflow-x: hidden">'+d+"</ul></div>");a.append(p);var u=e("ul",p),v=e("li",p),g=e("input",p),b=e("div.jq-selectbox__not-found",p).hide();v.length<s.selectSearchLimit&&g.parent().hide();var m=0,x=0;v.each(function(){var t=e(this);t.css({display:"inline-block","white-space":"nowrap"}),t.innerWidth()>m&&(m=t.innerWidth(),x=t.width()),t.css({display:"block"})});var f=a.clone().appendTo("body").width("auto"),y=f.width();f.remove(),y==a.width()&&(h.width(x),m+=a.find("div.jq-selectbox__trigger").width()),m>a.width()&&p.width(m),""===l.val()?(f=l.data("placeholder"),void 0===f&&(f=s.selectPlaceholder),h.text(f).addClass("placeholder")):h.text(c.text()),""===n.first().text()&&""!==l.data("placeholder")&&v.first().hide(),l.css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0});var C=a.outerHeight(),w=g.outerHeight(),q=u.css("max-height"),f=v.filter(".selected");1>f.length&&v.first().addClass("selected sel"),void 0===v.data("li-height")&&v.data("li-height",v.outerHeight());var k=p.css("top");return"auto"==p.css("left")&&p.css({left:0}),"auto"==p.css("top")&&p.css({top:C}),p.hide(),f.length&&(n.first().text()!=c.text()&&a.addClass("changed"),a.data("jqfs-class",f.data("jqfs-class")),a.addClass(f.data("jqfs-class"))),l.is(":disabled")?(a.addClass("disabled"),!1):(r.click(function(){if(e("div.jq-selectbox").filter(".opened").length&&s.onSelectClosed.call(e("div.jq-selectbox").filter(".opened")),l.focus(),!navigator.userAgent.match(/(iPad|iPhone|iPod)/i)){var t=e(window),o=v.data("li-height"),c=a.offset().top,d=t.height()-C-(c-t.scrollTop()),r=s.selectVisibleOptions,h=5*o,f=o*r;r>0&&6>r&&(h=f),0===r&&(f="auto");var r=function(){p.height("auto").css({bottom:"auto",top:k});var e=function(){u.css("max-height",Math.floor((d-20-w)/o)*o)};e(),u.css("max-height",f),"none"!=q&&u.css("max-height",q),d<p.outerHeight()+20&&e()},m=function(){p.height("auto").css({top:"auto",bottom:k});var e=function(){u.css("max-height",Math.floor((c-t.scrollTop()-20-w)/o)*o)};e(),u.css("max-height",f),"none"!=q&&u.css("max-height",q),c-t.scrollTop()-20<p.outerHeight()+20&&e()};return!0===s.selectSmartPositioning?d>h+w+20?r():m():!1===s.selectSmartPositioning&&d>h+w+20&&r(),e("div.jqselect").css({zIndex:s.singleSelectzIndex-1}).removeClass("opened"),a.css({zIndex:s.singleSelectzIndex}),p.is(":hidden")?(e("div.jq-selectbox__dropdown:visible").hide(),p.show(),a.addClass("opened focused"),s.onSelectOpened.call(a)):(p.hide(),a.removeClass("opened"),e("div.jq-selectbox").filter(".opened").length&&s.onSelectClosed.call(a)),g.length&&(g.val("").keyup(),b.hide(),g.keyup(function(){var t=e(this).val();v.each(function(){e(this).html().match(RegExp(".*?"+t+".*?","i"))?e(this).show():e(this).hide()}),""===n.first().text()&&""!==l.data("placeholder")&&v.first().hide(),1>v.filter(":visible").length?b.show():b.hide()})),v.filter(".selected").length&&(0!==u.innerHeight()/o%2&&(o/=2),u.scrollTop(u.scrollTop()+v.filter(".selected").position().top-u.innerHeight()/2+o)),i(u),!1}}),v.hover(function(){e(this).siblings().removeClass("selected")}),v.filter(".selected").text(),v.filter(".selected").text(),v.filter(":not(.disabled):not(.optgroup)").click(function(){l.focus();var t=e(this),i=t.text();if(!t.is(".selected")){var o=t.index(),o=o-t.prevAll(".optgroup").length;t.addClass("selected sel").siblings().removeClass("selected sel"),n.prop("selected",!1).eq(o).prop("selected",!0),h.text(i),a.data("jqfs-class")&&a.removeClass(a.data("jqfs-class")),a.data("jqfs-class",t.data("jqfs-class")),a.addClass(t.data("jqfs-class")),l.change()}p.hide(),a.removeClass("opened"),s.onSelectClosed.call(a)}),p.mouseout(function(){e("li.sel",p).addClass("selected")}),l.on("change.styler",function(){h.text(n.filter(":selected").text()).removeClass("placeholder"),v.removeClass("selected sel").not(".optgroup").eq(l[0].selectedIndex).addClass("selected sel"),n.first().text()!=v.filter(".selected").text()?a.addClass("changed"):a.removeClass("changed")}).on("focus.styler",function(){a.addClass("focused"),e("div.jqselect").not(".focused").removeClass("opened").find("div.jq-selectbox__dropdown").hide()}).on("blur.styler",function(){a.removeClass("focused")}).on("keydown.styler keyup.styler",function(e){var t=v.data("li-height");h.text(n.filter(":selected").text()),v.removeClass("selected sel").not(".optgroup").eq(l[0].selectedIndex).addClass("selected sel"),38!=e.which&&37!=e.which&&33!=e.which&&36!=e.which||u.scrollTop(u.scrollTop()+v.filter(".selected").position().top),40!=e.which&&39!=e.which&&34!=e.which&&35!=e.which||u.scrollTop(u.scrollTop()+v.filter(".selected").position().top-u.innerHeight()+t),13==e.which&&(e.preventDefault(),p.hide(),a.removeClass("opened"),s.onSelectClosed.call(a))}).on("keydown.styler",function(e){32==e.which&&(e.preventDefault(),r.click())}),void e(document).on("click",function(t){e(t.target).parents().hasClass("jq-selectbox")||"OPTION"==t.target.nodeName||(e("div.jq-selectbox").filter(".opened").length&&s.onSelectClosed.call(e("div.jq-selectbox").filter(".opened")),g.length&&g.val("").keyup(),p.hide().find("li.sel").addClass("selected"),a.removeClass("focused opened"))}))}function a(){var s=new t,c=e("<div"+s.id+' class="jq-select-multiple jqselect'+s.classes+'"'+s.title+' style="display: inline-block; position: relative"></div>');l.css({margin:0,padding:0}).after(c),o(),c.append("<ul>"+d+"</ul>");var a=e("ul",c).css({position:"relative","overflow-x":"hidden","-webkit-overflow-scrolling":"touch"}),r=e("li",c).attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none","white-space":"nowrap"}),s=l.attr("size"),h=a.outerHeight(),f=r.outerHeight();void 0!==s&&s>0?a.css({height:f*s}):a.css({height:4*f}),h>c.height()&&(a.css("overflowY","scroll"),i(a),r.filter(".selected").length&&a.scrollTop(a.scrollTop()+r.filter(".selected").position().top)),l.prependTo(c).css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0}),l.is(":disabled")?(c.addClass("disabled"),n.each(function(){e(this).is(":selected")&&r.eq(e(this).index()).addClass("selected")})):(r.filter(":not(.disabled):not(.optgroup)").click(function(t){l.focus();var s=e(this);if(t.ctrlKey||t.metaKey||s.addClass("selected"),t.shiftKey||s.addClass("first"),t.ctrlKey||t.metaKey||t.shiftKey||s.siblings().removeClass("selected first"),(t.ctrlKey||t.metaKey)&&(s.is(".selected")?s.removeClass("selected first"):s.addClass("selected first"),s.siblings().removeClass("first")),t.shiftKey){var i=!1,o=!1;s.siblings().removeClass("selected").siblings(".first").addClass("selected"),s.prevAll().each(function(){e(this).is(".first")&&(i=!0)}),s.nextAll().each(function(){e(this).is(".first")&&(o=!0)}),i&&s.prevAll().each(function(){return e(this).is(".selected")?!1:void e(this).not(".disabled, .optgroup").addClass("selected")}),o&&s.nextAll().each(function(){return e(this).is(".selected")?!1:void e(this).not(".disabled, .optgroup").addClass("selected")}),1==r.filter(".selected").length&&s.addClass("first")}n.prop("selected",!1),r.filter(".selected").each(function(){var t=e(this),s=t.index();t.is(".option")&&(s-=t.prevAll(".optgroup").length),n.eq(s).prop("selected",!0)}),l.change()}),n.each(function(t){e(this).data("optionIndex",t)}),l.on("change.styler",function(){r.removeClass("selected");var t=[];n.filter(":selected").each(function(){t.push(e(this).data("optionIndex"))}),r.not(".optgroup").filter(function(s){return-1<e.inArray(s,t)}).addClass("selected")}).on("focus.styler",function(){c.addClass("focused")}).on("blur.styler",function(){c.removeClass("focused")}),h>c.height()&&l.on("keydown.styler",function(e){38!=e.which&&37!=e.which&&33!=e.which||a.scrollTop(a.scrollTop()+r.filter(".selected").position().top-f),40!=e.which&&39!=e.which&&34!=e.which||a.scrollTop(a.scrollTop()+r.filter(".selected:last").position().top-a.innerHeight()+2*f)}))}var n=e("option",l),d="";if(l.is("[multiple]")){var r=!!navigator.userAgent.match(/Android/i),h=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/i);r||h||a()}else c()};i(),l.on("refresh",function(){l.off(".styler").parent().before(l).remove(),i()})}}):l.is(":reset")&&l.on("click",function(){setTimeout(function(){l.closest(s.wrapper).find("input, select").trigger("refresh")},1)})}).promise().done(function(){s.onFormStyled.call()})}}(jQuery);